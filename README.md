# MysteryBox - Бот для розыгрышей в Discord

MysteryBox - это Discord бот, который позволяет создавать розыгрыши с таймером и случайными призами. Пользователи могут участвовать в розыгрыше, нажав на кнопку, а в конце бот автоматически выбирает случайного победителя.

## Функции бота

- Создание розыгрышей с настраиваемым временем окончания
- Кнопка для участия в розыгрыше
- Автоматический выбор случайного победителя по истечении времени
- Случайный выбор приза из заранее настроенного списка
- Управление списком призов (доступно только администраторам)
- Загрузка списков призов из текстовых файлов
- Назначение набора призов для конкретного розыгрыша
- Возможность указания диапазонов призов (например, "1-3")
- Просмотр списка участников
- Возможность отмены активного розыгрыша
- Досрочное завершение розыгрыша
- Настройка точного времени окончания розыгрыша
- Возможность добавления GIF-анимации для поздравления победителя

## Команды

Все команды доступны только для пользователей с правами администратора.

### Основные команды

- `/mysterybox [hours] [minutes] [title] [description]` - Создать новый розыгрыш
  - `hours` - количество часов до окончания розыгрыша (по умолчанию 24)
  - `minutes` - количество минут до окончания розыгрыша (по умолчанию 0)
  - `title` - название розыгрыша (по умолчанию "Таинственный розыгрыш")
  - `description` - описание розыгрыша (по умолчанию "Нажмите на кнопку ниже, чтобы принять участие в розыгрыше!")

- `/participants [giveaway_id]` - Посмотреть список участников розыгрыша
  - `giveaway_id` - ID розыгрыша (указан в нижней части сообщения с розыгрышем)

- `/cancelgiveaway [giveaway_id]` - Отменить активный розыгрыш
  - `giveaway_id` - ID розыгрыша для отмены

### Управление призами

- `/addprize [prize_id] [prize_name]` - Добавить приз в список возможных призов
  - `prize_id` - уникальный идентификатор приза
  - `prize_name` - название приза

- `/removeprize [prize_id]` - Удалить приз из списка возможных призов
  - `prize_id` - ID приза для удаления

- `/listprizes` - Посмотреть список возможных призов

- `/assignprizes [giveaway_id] [prize_ids]` - Назначить призы для конкретного розыгрыша
  - `giveaway_id` - ID розыгрыша
  - `prize_ids` - Список ID призов через запятую или диапазон (например, '1,2,3' или '1-3')

### Управление списками призов

- `/createprizelist [list_id] [list_name]` - Создать список призов из текстового файла
  - `list_id` - уникальный идентификатор списка призов
  - `list_name` - название списка призов для отображения

- `/listprizelists` - Показать все доступные списки призов

- `/viewprizelist [list_id]` - Просмотреть содержимое списка призов
  - `list_id` - ID списка призов

- `/removeprizelist [list_id]` - Удалить список призов
  - `list_id` - ID списка призов для удаления

- `/assignprizelist [giveaway_id] [list_id]` - Назначить список призов для розыгрыша
  - `giveaway_id` - ID розыгрыша
  - `list_id` - ID списка призов

### Управление временем розыгрыша

- `/endgiveaway [giveaway_id]` - Досрочно завершить розыгрыш
  - `giveaway_id` - ID розыгрыша для завершения

- `/setexacttime [giveaway_id] [date] [time]` - Установить точное время окончания розыгрыша
  - `giveaway_id` - ID розыгрыша
  - `date` - дата в формате ДД.ММ.ГГГГ
  - `time` - время в формате ЧЧ:ММ

### Управление GIF-анимациями

- `/uploadgif [gif_id] [gif_name]` - Загрузить GIF-анимацию для поздравления победителя
  - `gif_id` - уникальный идентификатор GIF-анимации
  - `gif_name` - название GIF-анимации

- `/listgifs` - Показать все доступные GIF-анимации

- `/attachgif [giveaway_id] [gif_id]` - Прикрепить GIF-анимацию к розыгрышу
  - `giveaway_id` - ID розыгрыша
  - `gif_id` - ID GIF-анимации

## Настройка и запуск

1. Создайте бота в [Discord Developer Portal](https://discord.com/developers/applications)
2. Получите токен бота и ID приложения
3. Настройте переменные окружения:
   - `DISCORD_TOKEN` - токен вашего бота
   - `APPLICATION_ID` - ID приложения
   - `SYNC_COMMANDS` - установите в `true` при первом запуске, затем измените на `false`
   - `DEBUG_MODE` - установите в `true` для отладки или `false` в продакшене
4. Запустите бота с помощью команды `python main.py`

## Дополнительные переменные окружения

- `SYNC_COMMANDS` - если установлено в `true`, бот будет синхронизировать команды с Discord при каждом запуске. Это необходимо выполнить только один раз после изменения команд, чтобы избежать ограничений API Discord.
- `DEBUG_MODE` - если установлено в `true`, бот будет:
  - Игнорировать ограничение на серверы (работать на любом сервере)
  - Игнорировать проверку прав администратора
  - Выводить дополнительную отладочную информацию в логи

## Рекомендуемый рабочий процесс

1. При первом запуске бота или после добавления новых команд:
   - Установите `SYNC_COMMANDS=true` и `DEBUG_MODE=true`
   - Запустите бота один раз для синхронизации команд с Discord
   - Измените `SYNC_COMMANDS=false`, чтобы избежать ограничений API
2. Для обычной работы бота:
   - Установите `SYNC_COMMANDS=false` и `DEBUG_MODE=false`
3. Для тестирования на своем сервере:
   - Установите `DEBUG_MODE=true`, чтобы временно отключить ограничения

## Ограничения сервера

Бот по умолчанию работает только на следующих серверах:
- 714813888226525226 - Основной сервер
- 1093641722589876336 - Тестовый сервер

Для отключения этого ограничения во время разработки и тестирования, установите `DEBUG_MODE=true`.

## Примечания

- Список призов и активные розыгрыши сохраняются в директории `data` в формате JSON
- Если бот перезапускается, он автоматически восстанавливает активные розыгрыши и их таймеры
- Пользователь может участвовать в розыгрыше только один раз
- Списки призов можно создавать из текстовых файлов с построчным указанием призов
- Формат строки в текстовом файле: `ID:Название приза`
- Для указания диапазона призов можно использовать формат '1-5' вместо '1,2,3,4,5'
- GIF-анимации для поздравления победителя должны иметь соотношение сторон 1:1
- Бот имеет встроенную систему защиты от ограничений API Discord с экспоненциальной задержкой повторных попыток